一种高性能通用处理模块的设计与实现
综合化技术的发展对嵌入式通用处理模块的设计提出了更高的要求。提出一种高性能通用处理模块的设计实现方案，模块采用多片双核处理器阵列同时具备高性能的数据和信号处理能力；采用高速串行总线来构建满足不同应用的高速数据通信链路；采用交换开关式互连结构支持可扩展性和多级容错/重构功能；采用符合VITA46规范的VPX标准设计，满足综合化嵌入式系统多任务实时处理的应用需求。

嵌入式系统 数据信号处理 开关式互连 高速串行总线  

足不同应用的高速数据通信要求;采用交换开关式互
连体系结构设计,支持容错、重构和互连扩展能力;采
用VPX标准架构设计,符合通用化、系列化、组合化的
设计要求,是一种通用的高性能COTS(商用货架产
品)模块。
1相关背景技术
1.1“处理器技术
崴人式系统的发展很大程度上依赖于处理器技术
的发展,处理器技术是影响模块性能和实现的最重
要因素。技术和市场的双重动力推动了崴人式处理器
的飞速发展,应用比较广泛的有PowerPC系列、KX86/
PENTIUM系列、,ARMR&5]MIPS系列等川,这些门类
的处理器具有不同的特点,应用领域也各有侧重。在
高性能军用嵌人式造用处理领域,基于AltiVec技术的
PowerPC处理噬基本处于统治地位,AltiVecPowerPC
处理器具备强大的近算处理能力,有成熟的崴人式
实时操作系统支持,开发环境、生态系统完咤。另外,
AltiVec技术使得PowerPC处理器具备强大的矢量运
算能力,在嵌人式实时信号处理领域得到越来越广泛
的应用。本模块许计中,梁用4片高性能PowertPC双
核处理器MPC8640D组建处理器阵列,满足嵌入式系
统实时运算处理的需求。
1.2“高速串行总线技术
嵌人式系统的通信互连总线已经实琨了由传统的
共享分层总线(如PCI,、VME总线等)到高速串行总线
的发晚,以SerialRapidIO、PCIExpress为代表的新城总
线已在崴人式系统中得到或熟应用。
RapidIO 技 术 (ISO/IEC DIS 18372) 是 一 种 高 性 能
低引脚数.基于包交换的交叉开关互连技术,适合于多
器件紧糖合的工作环境,具有高带宽、低延时、高效率
及高可靠性的优点,为高性能嵌入式系统的内部互连
通信提供了良好的解决方案“)。在高速通用处理设计
中,通过交换开关互连实现RapidIO总线互连,完成模
块上处理器之间和与系统其他模块处理器间的高速
通信。
PCIExpress是取代PCI总线的第3代VO技术,
可以视为PCI总线点到点版本,从软件的观炉来看,与
PCI总线有良好的继承性,可以维持与PCI架构的互
连兼容性““。在模块设计中,通过交换开关实琨PCI
Express总线互连,完成与系统其他接口扩履模块的高
速眨射通信,实现模块的系统接口(如FC、AFDX接
口)扩展。
GigabitEthemet技术作为一种高速以太网技术,
继承了传统以太网结构筒单、算法简洁、良好兼容性、
技术价格便宣的特点,又显著提高了传输速率。模块
设计中,通过交狼开关实现CigabitEthernet总线互连,
完成模块与系统中交换模块的以太网连接,实现模块
和系统统一的以太网接口,可以完成基于以太网接口
的调试维护和远程数据加卸载功能。
1.3 VPX 技 术
通用处理模块是采用VPX规范设计的COTS产
咤,符合通用化、系列化、组合化的发展需求。VPX
(ANSIMVITA46)技术是基于VME技术发展丽来的一
种新型的背板交换技术,是VME技术革命性的创新发
展,其有传输带宽高、传输可靠度高、互连结构灵活可
酒置、产品寿命周期长等特点,特别适合军用嵌入式领
域的应用。VPX定义了集中式、分布式两种系统互逊
结构,采用基于交换开关的互连网络,有多种串行开关
协 议 映 射 在 VPX 中 , 如 Serial RapidIO PCI Express, 10
GEthernet等“1。VPX系统保持了与传统VME总线的
兼容丢,有效提升了总线带宽和系统的工作特性。
2硬件系统设计
2.1“系统架构描述
高性能通用处理模块的系统架构如图1所示。
高性能通用处理模块采用4JPowerPC双核处理
器MPC8640D组建处理器阵列,单处理内核工作主频
1.0GHa,具备高性能的数据处理和信号处理能力。每
个处理器具有独立的存储资源:.DDR2SDRAM用于高
速数据缨存;FLASH用于程序软件和数据的存储;NvS-
RAM具备掉电数据保存功能,用于存傅关键数据。模
坏上通过可编程控制递辑器件实现模块控制逻辑,同
时通过FPCA实现离散量接口,完成模块的输人/输出
和中断控制。
模块上处理器的RapidIO接口采用内部交换开关
实现高速互连通信,交换芯片通过底板连接器对外输
Hi4路4xRapidIO接口,用于构建并行处理系统;经光
电转换善将RapidI0转换为光信号,通过模块前面板输
出,实现系统闭的高速长距互连。处理器的PCIe接口
连接至PCfe交换芯片上,实现处理器间的PCle通讯,交
换芯片引出4xPCle总线至底板连接咤,完成模块的高
速系统接门(如FC、AFDX)扩展。每个处理嗣输出1
路千兆以太网接口,返接至Cbe交换芯片实现交换互
返,Cbe交换芯片对外输出1路Cbe至前面板,用于模
块的调试维护,输出!路Gbe接口和1路CbeSerdes
接口至底板连接咤,用于数据加卸载和系统互连。模
块为6UVPX标准模块,符合VITA46规范要求。
下面将简要介绍模块主要功能电路的设计实玩
方案。
2.2处理骸电路
高性能通用处理模块上,采用4片高性能双核
PowerPC处理器组建处理器阵列来实现超高实时运算
处理功能。处理器札用Freeseale公司的PowerArchi-
tecture“结构双核处理命MPC8640D,该处理器属于
PowerPC的第6代高性能处理器,每片处理器集成2个
e600处理内核,工作主频设定为1.0GHz。每个e600
内核内部集成的AliVec“单元支持128位的向量操
作,具备强大的浮点处理和矢量运算能力。处理器的
e600内核提供32kB的L1指令和数据cache及1MB
的I2eache,保证两个核在运行独立操作系统万有限
数据共享下的处理效率17。
MPC8640D处理器背部集成了丰富的接口控制
命,内部采用高速互连技术来平衡处理器的性能与I0
系统的否吐率。处理器内部有两个72位(带ECC校
验)的DDR2控制器,既可以增加双核操作系统隔离
度,又可以实玩数据共享,从而有效利用存储器带宽。
处理器配置了两种高速串行接口,一种是可配置为1x、
2x4x8x的PCIExpress接口,另一种是史配置为1x,
4x的SerialRapidfO接口,可以实现高速数据通信。处
理器迦集成了4个10/100/1000Mbit/s以太网控制
$4, 7 ￥ % MI/RMIL/GMIL/RGMIL/TBI/RTBI 工 作 模
式。此外MPC8640D还集成了2C接口、.UART接口、
中断控制器、DMA控制器,CPIO等资源“。
图 2 所示为MPC8640D处理器的内部结构图。
模纯上每个MPC8640D处理器通过内部集成的
DDR2存储器接口为每个处理器核各配置GB的DDR2
SDRAM存傅器,72bit数据容度,其中8bit为ECC校验
位,时钟频率设定为200MHz,即工作频率DDR2-400。
存储器采用双通道对秘设计,支持对称和独立操作系
统的运行。
MPC8640D处理器集成32bit地址/数据复用的局
部总线控制器,最高操作频率133MHz,可以实现存
借器扩展功能。设计中通过FPGA实现访问控制,为
每个处理器配置128MB的FLASH存储器,数据位宽
16bit,用于系统程序和应用程序代码的固化存借。酯
128kB的NvSRAM存傅器,8bit数据位宽,用于关
键数据掉电保护。
2.4RapidiO功能申路
模块上由两片RapidI0交换芯片组建Rapidi0交
换互连网络,实现模块内、模块间和系统间的RapidIO
高速数据传输。通过RapidlO交换芯片实琨16个4x
端口的高速RapidIO互连,分别连接4片MPC8640D处
理器,通过底板连接器对外输出4路4xRapidlO接口,
用于构建并行处理系统;经光电转换器将RapidIO转
换为光信号,通过模块前面板输出,实现系统间的高速
长距互连。
RapidI0交换网络配置管理采用两种方式
实现。一种给每个交换芯片配置独立的引导PQCPROM,
存傅交换网络的初始化配置信息,包括端口工作模式、
工作速率、通信路由表等。模块加电运行时,自动加载
PROM中的配置信息,完成RapidIO交换网络的初始化
UAE,RapidlO交换网络的另一种配置方式采用实时
管理的方法实现,模块上的1个处理器节点配置为
Host模式,其他3个节点配置成为Agent模式,系统实
时运行中,由Host主节点实现RapidIO全互连网络实
时监控管理和动态重配置,提供对可扩展性和多级容
错/重构功能的底层支持。
模块上RapidIO功能电路示意图如图3所示。
模块上将4个MPC8640D处理器的1个高速串行
SerDes接门配置为PCIExpress接口功能,4x工作模
式,工作频率设定为2.5Gbitts。处理器的PCle接口
连接至PCIe交换芯片上,实现处理器间的PCIe通讯,
交换芯片引击2路4xPCle总线至底板连接器,可以与
系统中多功能接口模块互连,完成模块的高速系统接
口(如FC、AFDX)扩展。PCIe交换芯片支持48线、12
端口的PCLExpressGen2交换,支持PCIe的非透明桥
( Non-Transparent Bridging,NT) 传 输 , 设 计 中 将 对 外 的
PCle接口连接到NT端口以支持Dual-Host操作。
模块上将4个处理器节点的PCLExpress接口中的
1个配置为PCIe总线的RootComplex(RC)设备,其他
3个节点配置为Endpoint(EP)设备。模块在运行过程
中,由RC节点设备实现对整个PCIExpress互连网络
的初始化配置和系统的实时监控管理。
模块上PCIExpress功能电路示意图如图4所示。
2.6“以太网功能电路
模块上通过以太网交换芯片实现基于CigabitEther-
net的互连网络。4片MPC8640D处理器的以太网控
制器配置为CMII标准模式,外接千兆PHY实现与交
换芯片的连接。以太网交换芯片支持从8x1Ccopper
PHY, 9x 1 G SGMII, 2x 2.5 G SGMII 中 选 择 11 个 以 太
网接口进行交换。设计中,选用6个1GcopperPHY
端口分别连接4个处理器的Cbe接口,对外输出1路
Cbe至前面板用于模块的调试维护,输出1路Cbe接
口和2路CbeSerdes接口至底板连接器,用于数据加
卸载和系统互连。
模块上以太网功能电路示意图如图5所示。
模块上选用1片FPGA芯片实现接口逻辑控制功
能,实现模块的复位控制中断管理,处理器局部总线
访问控制,可配置看门狗.离散量控制和模块控制状态
寄存器等功能。
2.8“温度监控电路
模块的温度监控电路采用处理器集成的2C总线
接口实现,设计中,通过I2C总线接口为每个处理器配
置独立的温度监控检测电路,用于监控处理器的温度,
实现超温保护功能。
2.9“通信串口电路
MPC8640D处理器集成了两路丨口控制器(UART),
设计中,每个处理器实现1路RS232通信串口,用于处
理器调试运行时的状态显示;另1路UART接口实现
RS422接口协议,用于模块间的状态通信管理。
3“软件配置
通用处理模块是通用的实时计算控制平台,配置
基础支持软件包括操作系统.驱动程序包等,应用软件
由具体任务系统开发。
3.1“操作系统
模块上MPC8640D处理嚣配置美国风河公司的
VxWorks崴人式实时操作系统(RTOS),满足实时性
要求极高的崴人式领域应用。MPC8640D为双核处
理 器 , 设 计 中 实 现 SMP ( Symmetric Multiprocessing ) 和
AMP( Asymmetric Multiprocessing) 两 种 不 同 架 构 的 操 作
系统配置。SMP架构可以简单理解为处理器的两个处
理内核运行同一操作系统,由操作系统实现对处理资
源和接口资源、存储资源的统一管理;AMP架构是处
理器的每个处理内核运行各自独立的操作系统,具备
独立的存傅资源,通过核间通信机制实现管理“1。模
块上处埋器AMP架构采用VxWorks5.5操作系统,
SMP架构采用VxWorks6.8操作系统。
3.2“驱动程序
模块上运行的驱动程序包括存储器驱动、接口驱
动、中断管理等。SerialRapidIO接口设定为Host节点
功能的处理器,提供RapidIO互连网络的初始化、通信
路由表配置和实时监控管理软件。PCIExpress接口设
定为RC功能的处理器,提供对PCIe互连网络的初始
化配置和实时监控管理软件。
4“模块实例照片
通用处理模奂采用符司VITA46规范设计,为6U
VPX标准模块,符合“三化“要求,是一种通用的高性
能COTS产品。模块的实物照片如图6所示。
通用处理模块完成了全部功能、性能的测试工作,
以下重点介绍处理器矢量运算性能和RapidIO传输性
能的测试。
5.1“处理器矢量运算性能
测试PowerPC8640D处理器AltiVee“单元的矢量
运算性能,为PowerPC处理器在信号处理领域的应用
提供依据。测试条件:PowerPC8640D处理器单核工作
(0核使能,1核禁止),工作主频1CHz,运行单核操作
系统VxWorks5.5。矢量库采用VSI/ProCore矢量库,
选取“复乘“和“FFT“2个典型算法测试,测试用数据
全部使用复数形式,采用正态分布随机产生。测试结
果如表1所示。
表 1 处理器AltiVec““单元矢量运算性能测试结果
Table 1 Test results of AltiVee? unit vector
operation performance
序号点数房二址操藿乘/塞址操作Fh
1 16 0.42 0.41 0.73 0.72
2 32 0.45 0.45 0.68 0.69
3 64 0.54 0.54 1.10 0.99
4 128 0.71 0.72 1.49 1.48
5 256 1.06 1.13 2.65 2.65
6 512 1.76 4.47 5.54 5.82
7 1024 3.4 8.60 11.39 12.16
8 , 2048 9.20 11.23 24.46 27.00
9 4096 22.38 21.29 67.47 68.34
10 8192 40.53 42.34 161.77 207.57
1 16384 82.18 482.50 345.95 503.65
12 32768 162.69 1343.39 803.58 1761.11
5.2RapidIO传输性能测试
测试模块上PowerPC8640D处理器集成的RapidIO
接口的传输性能,分析不同模式下RapidIO的传输带
宽,为高速数据传输应用设计提供依据。测试条件:两
个处理器通过RapidIO交换进行数据通信,处理器工
作主频1GHz,外存DDR2SDRAM工作速率为DDR2-
400。RapidIO接口工作在4x模式,速率为1.25Gbit/s,
2.5 Gbit/s 3. 125 Gbis/s, 测 试 NWRITE 带 宽 , 模 块 上
RapidIO的传输性能测试结果如图7所示。
依据高度综合化技术发展对嵌人式通用处理模坂
设计提出的需求,结合高性能通用计算控制技术的发
展趋势,本文提出一种高性能通用处理模块的设计实
现方案。该模块具备超高性能的数据信号处理能力、
高效能的数据传输能力和灵活的开关交换式互连体系
结构,产品采用符合VITA46/VITA48规范的VPX标
(下转第88页)
图 14 UUT接收数据内容
Fig. 14 Data received by UUT
4“结论
本文研究的ARINC429总线故障注人测试方法克
服了传统总线测试覆盖性不全的缺陷,提升了测试的主
动性。通过对故障注人原理,总线故障模式及故障实现
方法的论述,实现了ARINC429总线典型故障的模拟,构
建了故障注人单元.控制单元以及总线信号发生器的基
本框架,通过实验验证了故障注人测试方法的有效性,
达到了预期设定的目标。
基于本文提出的故障注人测试方法,可以实现大部
分电气层、物理层.协议层的故障模拟,对于其他总线故
障注入测试方法的研究有重要的参考价值。
