一种电子磁罗盘航向误差的自适应补偿方法
分析软硬磁干扰对磁罗盘航向角的影响,建立相应的磁罗盘航向误差模型,并将模型参数作为卡尔曼滤波器的状态量,在MIMU的辅助作用下,使模型参数随周围磁场环境变化而改变,增强了磁罗盘航向测量的环境适应性。卡尔曼滤波器的观测量分为常规观测量和机动观测量,机动观测量在估计航向误差模型参数时增加了当前航向的权值,提高了当前航向的误差补偿精度。实验数据表明,在干扰磁场较强且人为改变干扰磁场的情况下,最大航向误差为±14.5°,经过自适应补偿后降至±0.2°以内。本算法可以精确地、自适应地对磁罗盘航向误差进行补偿,非常适合在周围磁场易变化的环境中使用。

电子磁罗盘 航向误差 卡尔曼滤波器 自适应补偿  

13言
地磁场作为地球的固有信息,对其进行精确测量
在导航定位、地球物理研究以及矿藏探测等方面都有
重要的应用价值1。磁罗盘作为一种常用的磁场测量
仪器,通过测量周围磁场在三轴磁传感器轴向上的分
量来计算磁场强度以及航向角,具有体型小,成本低,
低功耗,误差不随时间累积等优点,在导航定向定位
中得到广泛应用团。但是地球磁场比较微弱,而周围
环境中各种各样的磁场干扰,例如车辆,矿藏,楼房
等,会严重影响磁罗盘的测量精度,所以磁罗盘在使
用前非常有必要进行校正补偿,提高其测量精度4
磁罗盘并不是只在一个固定的地点进行航向测量,测
量地点的大范围变化以及周围环境的改变都有可能
引起磁场环境的改变,影响磁罗盘误差补偿的精度,
从而要求补偿方法能够根据周围磁场环境自适应改
变补偿参数,使磁罗盘在变化的磁场环境中也能保证
相应的航向测量精度。
目前磁罗盘误差补偿比较常用的方法有椭圆拟
合补偿法、椭球拟合补偿法[、基于外部基准辅助
的磁场强度补偿法L““口基于外部基准辅助的航向误
差补偿法L等方法。磁罗盘的X轴和Y轻用来测
量地磁场在水平轴向上的分量,磁罗盘水平旋转一周,
如果周围没有干扰磁场,X,Y轴轴向上测量得到的磁
场强度u和Hv应该服从圆心在原点的正圆分布,
但是当周围存在干扰磁场时,正圆分布就变为圆心偏
离原点的椭圆分布。椭圆拟合补偿法就是将磁罗盘水
平旋转一周,采集各个方向上的磁场数据,拟合出楠
圆数学模型中的参数,然后将椭圆分布补偿为圆心在
原点的正圆分布,从而减小干扰磁场的影响,方法简
单易实施,但是只适用于水平旋转的情况0。椭球拟
合补偿法是榈圆拟合补偿法的拓展,将两维拟合拓展
到三维拟合,即将一个球心脱离原点的棒球分布重新
拟合补偿为一个球心在原点的圆球分布,保证了磁罗
盘在全姿态下的补偿精度,比榈厨拟合补偿法的适用
范围更广,补偿精度更高,但是其补偿方法也更复
杂。文献[6]可在无外界基准的情况下拟合出椭球模埕
中的9个参数,但是无法完全确定软磁干扰矩阵KX,
即无法完全求出泊松误差模型中的12个参数。为减
小大矩阵的简化对补偿效果的影响,分析对正定矩阵
K'K采用不同分解方式造成的补偿效果的差异,通过
实验表明对其进行乔里斯基分解得到的下三角矩阵
有较好的补偿效果。文献[7]利用地磁矢量与一个辅助
矢量的点积为常数,可以完全确定泊松误差模城中的
12个参数。文献[8]对软磁干扰矩阵的求取则是对椭
球拟合后的正定矩阵KKK进行奇异值分解求得。椭球
拟合中采样点的选取也对补偿效果有重要的影响,文
献[9]分析了均匀取点和非均匀取点的补偿效果,并
在均匀取点中对等夹角取点算法和等面积取点算法
进行对比,得出等夹角取点算法有更好的补偿效果。
外部基准辅助的磁场强度补偿法利用其他传感
器的数据作为外部基准对磁罗盘误差参数进行计算,
从而提高磁罗盘对地球磁场的测量精度。文献[10]在
惯性元件的辅助作用下分别利用扩展卡尔曼溏波和
粒子滤波对误差项进行计算,在初始误差较小的情况
下,两种方法对硬磁干扰造成的误差都有很好的补偿
效果,但在初始误差较大的情况下粒子滤波有更好的
补偿效果。为消除参数初值在传统迭代算法中对补偿
效果的影响,文献[11]利用差分进化算法对三轴磁强
计进行校准补偿,在不同的参数初值下都保持较高的
补偿精度。文献[12]分析了磁罗盘误差参数的非线性,
并利用最小二乘法对非线性误差参数进行计算,减小
了参数非线性对补偿效果的影响。为使组合导航系统
中其他导航方法的数据在磁罗盘的校正过程中得到
更好的应用,简化磁罗盘的校准过程,文献[13]利用
惯性元件以及GPS提供的妍态和航向角对磁罗盘进
行快速标定,使校准过程简单易实现。
基于外部基准辅助的航向误差补偿法首先分析
软硬磁干扰对航向角的影响,建立相应的航向误差模
型,然后以无磁转台的方向为基准,旋转一周,采集
一周的航向和航向误差数据,最后利用最小二乘法求
出航向误差模型中的参数,即可在以后使用过程中对
磁罗盘航向误差进行补偿。此方法只能在可以提供参
考航向的条件下才能进行校正,所以不便于随时随地
进行校正补偿U4。文献[15]利用惯性元件的航向为基
准,简化了磁罗盘航向误差的校正过程,可以在户外
无转台的情况下进行校正。文献[16]利用RBF神经网
路对磁罗盘航向误差进行补偿。
常用的补偿方法大多都使用的是固定参数,但是
在使用过程中,位置和环境的变化都可能会引起周围
磁场环境的变化,使原先参数的补偿效果降低。并且
计算模型参数时,采样点一般是在整个圆周或者球面
均匀分布,所以其在各个方向上补偿的精度是一致的,
并不能着重的提高当前航向的补偿精度。
为了降低干抢磁场对磁罗盘航向测量的影响,增
强磁罗盘航向误差补偿的环境适应性,本文提出了一
种利用卡尔曼滤波器来估计磁罗盘航向误差模型参
数的自适应算法。此算法是基于磁罗盘和微惯性测量
单 元 (micro inertial measurement unit, MIMU) 组 合 系 统 ,
利用MIMU的航向角作为基准来辅助计算磁罗盘航
向误差,当周围磁场发生变化,引起磁罗盘航向测量
值变化时,以MIMU航向角为基准计算得到的航向误
差作为卡尔曼滤波器的观测量也相应发生变化,每隔
一段时间对作为卡尔曼源波器状态量的航向角误差
模型参数进行一次估计,使其跟随周围磁场环境的变
化而变化,相应的计算得到当前磁场环境下的航向误
差,并对磁罗盘航向角进行补偿,增强了磁罗盘的环
境适应性,提高磁罗盘在变化的磁场环境下的航向测
量精度。为了提高当前航向的航向误差补偿精度,本
文增加了两个机动观测量来采集当前航向下的数据,
从而在计算航向误差模型参数时增加当前航向的权
值,提高当前航向的误差补偿精度。
2“系统结构
本文使用的组合系统是由一个三轲磁罗盘和
MIMU组成,三轴磁罗盘由1个双轴磁阻传感器
(HMC1022)和1个单轴磁阻传感器(HMC10212)组成,
测量环境磁场在3个轻向上的分量。MIMU由3个单轻
MEMS陀螺(ADXRS623)、1个双轴加速度计(ADXL203)
和I个单轴加速度计(ADXLI03)组成,测量载体3个轴
向上的角速度和加速度分量,从而计算得到载体的航向
和姿态角。碟场数据在经过娅态补偿后即可得到地磁场
的水平分量,从而计算得到磁罗盘的航向角07。
本系统使用磁罗盘和MIMU进行航向角测量,
这两种方法各有特点,磁罗盘容易受到磁场干扰影响,
但是其误差不随时间累积,MIMU不受磁场干扰影响,
但是其误差随时间累积。本系统就利用MIMU不受碟
场干扰的影响来辅助补偿磁罗盘航向误差。首先分析
磁场干扰对磁罗盘航向角的影响,建立相应的航向误
差模型;然后在MIMU航向角的辅助下利用卡尔曼滤
波器估计出航向误差模型参数;最后根据航向误差模
型和参数计算出当前磁场环境下的航向误差,对磁罗
盘航向角进行补偿。
3“航向误差的自适应补偿算法
3.1“磁罗盘航向误差模型
磁罗盘误差是由于铁磁介质的干扰引起的,这些
干扰又可分为硬磁干扰和软磁干扰,其中硬磁干扰是
由矫顽磁力较大的铁磁材料或者电器设备产生,这种
干扰相对比较稳定,其大小和相对于系统的方向保持
不变,所以它在磁罗盘三个轴上的分量是不变的。硬
磁干扰引起的航向误差随着航向角旋转一周与未补
偿的航向角y呈现正弦曲线关系,可用式(4)表示:
式中:A,B为半圆自差系数,用于计算硬磁于扰造成
的磁罗盘的半圆自差;y为未补偿的磁罗盘航向角。
软磁干扰由矫顽力较小的铁磁材料受地磁场或
电磁场的磁化而产生,其大小和相对于系统的方向随
着系统航向的变化而改变,根据实验分析,软磁十扰
引起的航向误差可以分为两部分,一是一个固定的航
向角偏差,二是磁罗盘旋转一周与2y昔现正弦曲线
关系的航向误差,如式(2)所示:
式中:C,D为参限自差系数,用于计算软磁十扰造成
的磁罗盘的象限自差;为恒定自差系数,用于计算
敖磁干扰造成的磁罗盘的恒定自差。
由式(1)、式(2)得干扰磁场造成的航向角偏差为:
A=Al+Ao =4dcos(y)+Bsin(y)+Ccos(2W)+Dsin(2W)+5(3)
即可得到航向误差补偿后的航向角:
式中:A为硬磁干扰造成的磁罗盘航向误差;A,为软
磁干扰造成的磁罗盘航向误差;4,B,C,D,E为航向误
差模型中的自差系数8171。
3.2“航向误差的自适应补偿
根据上文介绍的磁罗盘航向误差模型,将模型参
￥4.B.C.D\E作为卡尔曼滤波器的状态量,建
立相应的卡尔曼滤波方程C“21,如式(5)所示:
式中:xx为K时刻卡尔曼滤波器的状态量和航向误差
模型参数的估计值。yx为kK时刻卡尔曼源波器的观测_
量和磁罗盘航向误差。
式中:yi(=1,2,34,500HEi个常规观测量时,未
补偿的磁罗盘航向角。vaa(i=1,2,3,4,5)0THESEi个常
规观测量时,MIMU的航向角。ypn(f-1,2)为计算第!
个机动观测量时,未补偿的磁罗盘航向角,即当前时
刻未补偿的磁罗盘航向角。ywngr(心1,2)为计算第1个机
动观测量时,MIMU的航向角,即当前时刻MIMU的
航向角。
卡尔曼溏波器的观测量由7个采样点的磁罗盎与
MIMU的航向角差值组成,观测量分为5个常规观测
量和2个机动观测量.将航向角一周均分为5等份,每
个区间对应的磁罗盘和MIMU航向角仁和Wa(1,2,3,
4,5)被用来计算5个常规观测量,当磁罗揣航向角在
区间时,就更新相应的常规观测量和yu,而其他
区间的常规观测量保持不变,保证了计算出来的航向
误差模型参数在航向角一周的补偿精度。
2个机动观测量随着系统航向的变化而变化,由
磁罗盘和MIMU的航向角y和wir(1,2)计算得到,
即每次估计航向误差模型参数时,总有一个在当前航
向区间的常规观测量和两个当前航向的机动观测量
发生变化,提高了当前航向在估计航向误差模型参数
时的权值,使航向误差补偿在当前航向有更高的补偃
精度。
仁,为卡尔曼滤波器的观测矩阵,可以通过未补
偿的磁罗盘航向角计算得到。
首次使用时需要将系统旋转一周,采集5个常规
观测量的航向数据,然后利用最小二乘法计算得到碟
罗捐航向误差模型参数,作为卡尔曼滩波器状态量的
初值。
为了便于计算且由于测量条件限制,系统模型以
及噪声特性并不是完全准确的,有可能会引起传统卡
尔曼滤波器新的观测量的校正效果随时间降低,而先
前的观测量的校正效果随时间增加,使传统卡尔曼滤
波器状态量的估计值误差增大,影响了磁罗盘误差补
偿精度,所以本文采用衰准记忆法来增加新观测量的
权重来避免误差随时间增大。
P和Rx是定量描述x和观测量yx:中有用信息含
量的信息质量标志,而卡尔曼滤波器在计算状态量
Ey时根据这些信息质量标志自动确定出对观测量
yi(k<N)和x的利用程度,所以要减小yx(K不W)
和对fy的影响,可以相应的增大R:和Po。
根据需要相应的修改噪声的统计特性,将观测噪
声统计特性改为:
式中:R为时刻调整后的观测噪声方差,当测量
时间距离时刻N越远,其值就会越大。R为时刻调
整前的观测噪声方差。
初始状态量的统计特性改为:
为便于推导,将状态噪声统计特性修改为:
将式(6)-式(8)代入卡尔曼滤波方程计算中,并记:
即可得到:
由式(10)可以看出其与常规卡尔曼滤波方程相比
仅多出来个衰减因子s,且s>1,所以Byx_i要大于传
统卡尔曼滤波器的R,x_1l,WK,大于传统卡尔曼滤
波器的K,即在计算当前状态量忠=双t+
K; (Ve ~ Hi Rep) = (-K HR + Ky, in) 2 减 ZI
了先前观测量的权值,增加了当前观测量的权值,
解决了新观测量随时间增加校正效果逐渐降低的
问题。
磁罗盘在使用时,周围都会有楼房,矿藏,载体
等干扰磁场源,当载体有较大范围移动,或者周围环
境发生明显变化时,磁罗盘周围磁场也相应发生变
化,为减小磁场变化对磁罗擎的影响,本文在
MIMU的辅助下利用卡尔曼溏波器对航向误差模型
参数进行估计,使其根据磁场环境进行变化,增强
磁罗盘航向误差补偿的环境适应性。在航向测量中,
当前航向的精度才是主要测量的量,所以本文利用
机动观测量提高当前航向在计算航向误差模型参数
中的权重,着重的提高当前航向的航向误差补偿精
度。卡尔曼溏波器只在没有快速剧烈变化的磁场环
境中运行,即只有在干扰源相对稳定的情况下才运
行,防止例如车辆超车等短时间的磁场干扰造成模
型参数剧烈变化,从而影响参数稳定性的情况发生。
由于卡尔曼源波只在周围磁场环境不是快速剧烈变
化的情况下运行,所以卡尔曼溏波器每隔10s运行
一次,从而减小运算量。
4“实验结果分析
为验证本文提出的磁罗盘航向误差自适应补偿
方法的社偿效果,将磁罗盘和MIMU组合导航系统
与光纤陀螺(XW-GS1800)保持同轴放在无磁转台上
进行测试,测试中以光纤陀螺航向角为基准分析磁
罗盗的航向误差。先将系统水平放置一分钟对
MIMU迹行初始对准,然后水平旋转一周,采集相
应的数据,利用最小二乘法计算卡尔曼滤波器状态
量初值,以及噪声量初值,然后旋转转台,对比在
不同方位,自适应补偿法和固定参数法的补偿效果,
最后再改变周围干扰磁场,测试补偿方法对磁场环
境的适应性。
理论上的无干扰的磁场与实际测量有干扰的碟
场对比如图1所示,图中实线为理论上无干扰的磁场,
水平两个轴向上测量得到的磁场强度服从圆心处在
原点的正圆分布。实际环境中存在各种干扰磁场,所
以实际测量的磁场如图1中虚线所示,是一个圆心
偏离原点的椭圆分布。由此可见干扰磁场使磁场测
量值偏离了正圆分布,影响磁罗握的航向测量精度,
所以需要对磁罗盘进行航向误差补偿,减小干扰磁
场的影响。
025 r
一 0.3 -0.2 -0.1 0 0.1 0.2
Hx/Gauss
图 1 理论上无干扰的磁场和实际测量有干扰的磁场
Fig. 1 The ideal magnetic field without magnetic
interference and the actually measured magnetic field with
magnetic interference.
整个系统和光纤陀螺固定在无磁转台上测量完
初值以后,旋转一周,在各个方位停留一小段时间,
测量磁罗盘在各个方位的精度。图2分为上下两部分,
上图是整个过程中的航向数据,其中虚线是未经补偿
的磁罗盘航向角,实线是补偿后的磁罗盘航向角,点
划线是光纤陀螺的航向角,由图中可以看出补偿后的
磁罗盘航向角很好地跟随着光纤陀螺的航向,图中两
者航向曲线基本重合,而未经补偿的磁罗盘航向角在
栋些方位有比较大的偏差。下图为整个过程中以光纤
陀螺为航向基准,计算得到的磁罗盘航向误差,其中
虚线是未经补偿的磁罗盘航向角误差,最大误差为
14.5“,实线是使用本文所述方法进行自适应补偿后
的航向角误差,补偿后的航向角误差峰值大部分小于
0.2“,而误差曲线中一些较大的峰值是由两个原因造
成:一是磁罗盘数据与光纤陀螺数据采样频率并不相
同,磁罗盘航向角在计算时相对光纤陀螺有延迟,所
以转动中的航向误差会比较大;二是为了防止磁罗盘
航向角延迟在快速转动中对参数估计精度的影响,本
方法只在直线运动或者低转速运动时才进行卡尔曼滤
波运算,估计模型参数,转动过程中航向误差模型参
数保持不变,又由于在估计航向误差模型参数时,当
前航向的权值相对较大,使航向误差模型参数提高了
当前航向的补偿精度,但是其他航向的补偿精度相对
较低,在转动中模型参数更适用于转动前的航向角,
转动过程中的航向补偿精度低于转动前的航向补偿精
度。由图2可以看出当磁罗盘转动结束后,罗差模型参
数开始更新,使补偿后的航向误差快速收敛趋近于0。
0 500 1000 1500 2000 2500 3000 3500
fg fal /s
0 500 1000 1500 2000 2500 3000 3500
时间/s
图 2 磁罗盘航向角及航向角误差
Fig.2 The heading and heading error of the magnetic compass.
整个过程中x轴和y绅测量得到的轴向磁场强度
变化过程如图3所示。由图中可见!000s以后由于
人为的改变环境磁场,x,y两轴测量得到的磁场强度
发生变化,引起磁罗盘测量航向发生相应变化,误
差增大,所以需要磁罗盘校正方法相应的改变误差
模型参数,提高磁罗盘在改变后的磁场环境中的航
向精度。
时间/
图 3 x轴和y轴的磁场强度
Fig. 3 The axial intensity of magnetic field along axes x and y
图 4 中显示了固定参数法和自适应补偿法的航向
误差补偿效果对比。图中虚线为经过固定参数补偿后
的磁罗盘航向误差曲线,在前1000s,磁场环境不发
生变化,磁罗盘在一周各个方位的补偿精度比较高,
原本最大航向误差为14.5“,补偿后最大误差保持在
4以内。1000s后人为的改变环境磁场数次,使磁罗
盘航向误差发生变化,由图2中可见误差最大时为
-14.5“由于模型参数不随当前磁场变化,所以补偿
效果不理想,补偿后的最大误差为-12.3“。,可见此方
法对周围磁场环境的适应性不强。实线为本文提出的
自适应补偿算法补偿后的磁罗盘航向误差,可以看出
当磁罗盘旋转到某个方位时,史以快速估计出适合当
前方位的航向误差模型参数,并且由于机动木样点提
高了当前航向在计算航向误差模型参数时的权值,与
固定参数法相比明显提高了磁罗盘在当前方位补偿
后的航向精度,使补偿后的磁罗盘航向误差绝大部分
保持在0.2“以内,只有在转动过程中误差较大。1000s
后人为的改变环境磁场数次,引起磁罗盘航向误差变
化较大,卡尔曼滤波器也快速估计出适应当前磁场环
境的航向误差模型参数,对磁罗盘航向角进行补偿,
使表偿后的航向误差绝大部分保持在0.15“以内,只
有在磁场刚发生变化,模型参数迦没有更新时误差较
大,但模型参数也快速根据环境磁场进行改变,使磁
罗盘航向误差快速减小。由此可见本文提出的自适应
航向误差补偿法显著提高了磁罗盘的环境适应性,保
证了磁罗盘在各种磁场环境下的航向测量精度。
0 3560 1000 1500 2000 2500 3000 3500
时间/s
图 4 固定参数法和自适应航向误差补偿法补偿效果对比
Fig. 4 The comparison between the performances of the
fixed parameter method and the proposed algorithm
表 1 中的数据对未经补偿的磁罗盘航向角误差和
使用固定参数法以及本文提出的自适应航向误差补
偿法进行航向误差补偿后的磁罗盘航向角误差进行
详细对比。可见整个过程中未经补偿的磁罗盘航向角
误差均值为1.3024“,方差为70.8204,使用固定参数
法进行航向误差补偿后,碟罗盘航向误差均值缩小为
-0.7392°,方差缩小为32.5925,利用自适应航向误
差补偿法补偿后,整个过程的磁罗盘航向误差均值降
为0.0531°,方差降为1.0716。固定参数法在磁场环
境没有变化的情况下有较好的补偿效果,但是当磁场
环境发生变化以后,补偿效果就受到影响。自适应航
向误差补偿法则在整个过程中都对磁罗盘航向误差
进行有效的补偿,当磁场环境发生变化的情况下,可
以进行自适应调整,保证了航向补偿的精度。
表 1 未补偿和补偿后的磁罗盘航向误差均值和方差
Table 1 The mean and variance of the heading errors of
uncompensated compass and compensated compass
补偿方法误差均值(2)误差方差
未 补 偿 1.302 4 70.820 4
固定参数法0.739232.5925
自适应航向误差补偿法0.05311.0716
5“结论
本文介绍了一种基于磁罗盘和MIMU组合导航
系统的磁罗盘航向误差自适应补偿方法,对在复杂碟
场环境中的磁罗盘航向进行自适应补偿。周围磁场发
生变化时,此算法会快速的改变航向误差模型参数,
使其适应当前的磁场环境,保证了补偿后的磁罗盘航
向角的精度。卡尔曼源波器的观测量中含有两个机动
观测量,提高了当前航向在航向误差模型参数估计时
的权重,使磁罗盘在当前方位具有比其他方位更高的
航向补偿精度,实验结果也证明了航向误差的自适应
补偿方法显著地提高了磁罗盘的航向精度,使磁罗盘
的航向误差在各个方位以及磁场发生变化的情况下
都保持在0.2“以内,具有很强的环境适应性,并且此
方法简单易实现,可以在野外随时随地进行补偿,满
足了导航系统对精度和易实现的要求。
