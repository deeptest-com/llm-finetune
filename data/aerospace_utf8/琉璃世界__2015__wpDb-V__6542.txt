琉璃世界


1“引“言
在现代国防建设中,无人飞行器承担着大量
侦察、跟踪、作战等形式多样的任务,而侦察图像
一直是无人飞行器测控系统中最重要的侦察数
据。随着光学传感器技术、电子与通信技术以及
空间技术的日益发展,无人飞行器上的载荷数量、
载荷获取图像的分辨率以及获取图像的帧频等都
不断增加,这给有限的传输信道带宽带来了沉重
的压力。高速、高质量的图像压缩技术已成为解
决这些问题的关键途径之一3。然而,现代军事
战争对无人飞行器载荷获取的侦察图像压缩时延
提出了更高的技术要求。由于无人飞行器需要快
速及时地将编码后的数据传输至地面情报处理系
统,以供地面决策者对无人飞行器进行实时准确
的控制,进而实现无人飞行器的精确制导打击能
力。在这个过程中,超低时延的图像压缩传输系
统已成为任务成功的关键。目前,国内外许多大
学和研究机构在高速图像压缩领域开展了较多研
究,也取得了一定的科研成果[““1。硬件方面,哈
尔滨工业大学WU等推出了专用图像压缩芯
片[,西安电子科技大学图像所研制出了CCD立
体图像压缩芯片“,上海交通大学图像所研制出
了面向超高清视频图像压缩的专用压缩芯片,而
国外TI等大型半导体公司则推出了专用图像压
缩芯片等““.“)。这些芯片都采用标准或改进的
图 像 压缩算法完成编码,更多情况下,只注重编码
速度,对编解码传输时延关注较少。此外,虽然国
内外诸多学者在图像压缩算法理论上取得了不少
成果“51,但由于应用领域特殊,公开资料较少。
因此,目前开展无人飞行器测控系统需求的低时
延编码传输技术的研究十分必要。
本文为了实现超低时延高速图像的压缩传输,
在现场可编程门阵列(FPGA)中采用全并行方式设
计了一种基于小波分析的超低延时高速图像压缩
系统。由于小波变换具有比余弦变换更好的去除
冗余效果,所提算法首先采用多级整数小波变换去
除图像像沐间的相关性冗余;其次,针对变换后的
不同子带系数采用不同的量化阶,有效地去除图像
视觉冗余,接着并对最低频带LL子带进行预测编
码,进一步去除像素间的相关性冗余;由于哥伦布
编码和游程编码都不需要事先统计编码符号概率,
易于硬件实现,故最后熵编码采用指数和伦布编码
联合游程编码去除图像像素间的概率冗余。硬件
实现时采用高度流水化、模块化、规则化的方式完
成。系统具有图像采集、压缩传输同步进行的特
点,当一帧图像采集完成后,编码也几乎同时完成。
此外,由于算法采用全硬件实现,资源占有量少,使
得本文所提出的图像压缩技术易于集成到其它系统
中(如调制、射频系统,不筑要使用专用囹像压缩芯
片和通用数字信号处理器。因此,满足无人飞行器
测控系统高空密封环境下对低功耗技术的要求。
2“压缩系统传输延时特性分析
图 像 编解码传输系统时延主要分为以下几个
部分,图像采集时延Tu,,图像预处理时延T,,,
编码时延Tene,发送缓冲时延Tur,数据传输时延
Trans,以及解码时延Too55,1为编解码传输系
统时延特性示意图。假设采用通用数字信号处理
器对采集的图像数据进行实时(25frame/s)编
码,所产生的延时大小如下:
在帧频为25frame/s的实时编解码情况下,
一帧图像采集时间T为1000/25=40ms;ER
采集完成后经过前期预处理(可以不进行预处理,
但对编解码后的图像质量会产生影响,此处T,.
设为0ms);在实时压缩情况下,一帧图像的平均
编码时延T..为40ms;在链路的传输速率与编码
器的输出码流近似一致时,对延时影响比较大的
部分是发送缓冲区,设置缓冰区是为了解决变码
率码流的传输和存储问题。以H.264标准为例,
编码时各帧(I帧、PTB帧)编码后的码率相差
非常大,需要设定较大的发送缓冲区来缓存编码
后的码流。缓冲区越大,越能够承受码流的波动,
但相应地也会带来较大的延时,反之亦然。在编
码过程中,I帧的码流可能会充满整个缓冲区的
4/z,所以发送缓冲区延时一般为Touut一47..,在
码、显示延时约为280ms。则整个编解码传输系
统时延至少为520ms(不包括恒定带宽传输时延
!延旷|
3“算法并行实现方式
超低延时高速图像压缩技术对图像压缩算法
的特性要求可概括为数据结构简单,易于硬件的读
写,以及缓存访问;算法没有复杂的数据计算操作,
易于硬件高速并行计算操作;编码算法的各个环节
依赖性低,易于分割和合并;此外,算法的压缩性能
要较好,即编码后的图像在解码后要能够清晰地还
原原始图像。
3.1“编码算法数学原理
本文采用的压缩算法属于典型的变换编码方
式,由三部分构成:分别是变换、量化和熵编码。根
据香农信息理论,变换是为了去除图像像素的相关
性冗余,量化是为了去除视觉冗余,熵编码是为了
去除图像像素中的概率冗余。在进行算法设计、选
择时,充分考虑低延时图像压缩算法的FPGA实现
特征,以图像像素为编码单元,首先,将图像进行多
级二维整数5/3提升小波变换;之后,根据变换后图
像的各个子带系数的不同权重系数,采用不同的量
}'〈277十l〉」窜一〉〈e】c`(′27z一__1)一l二三〈坠迥钨茎王_一}鱼茎〕T,—1<2n+1<T+1,(1)
按照上述方式在图像行、列方向分别进行一次
提升,便得到图像的4个子带(HH子带、HLF
带、LH子带和LL子带),当进行下一级变换时只
需对新生成的LL子带再进行一次行、列方向提升
由压缩系统传输时延特性的分析可知,高度
略行的编码机制和硬件编码速度低下是造成编码
传输时延如此大的主要原因。
数据,引人了简单有效的预测算子以进一步去除其
中的相关性冗余;将预测后的低频子带数据和其它
高频子带数据,采用易于FPGA实现的自适应零游程
编码联合一0的指数贻伦布编码进行熵编码来去除
像素间的概率冗余。图2为本文采用算法结构框图。
图 2 算法流程棠图
Fig. 2 Flow chart of algorithm
二维5/3提升小波具有良好的去除囹像像素
相关性的特点。在对图像进行变换时,只需在行方
向和列方向分别进行一次提升变换即可。5/3小
波正向小波变换过程的数学表达式如式(1)和式
(2)所示,表达式中,K。n是一维数字X的对称周期
扩展信号,Y是信号X的提升结果。首先,FH
X信号对奇数项像素进行预测,在利用预测后的
信息Z对偶数项像素进行更新。了是X信号第一
个样本信息,工是X信号的最后一个样本信息。
即可。由于变换后不同子带中所含的信息对图像
重建所占的权重不同,而不同大小的子带码率分配
等效于对该子带量化器选择不同的步长。在此,引
人子带变换增益因子Gs。变换增益是衡量每个子
其中:Ao为图像最低频子带的LL量化步长,考虑
5/3提升小波变换为正交小波变换,则有G不2“,
结合式(3)可以得到小波变换后图像的各级子带量
化阶步长,如表1所示。
针对LL子带图像像素仍有很强相关性的特
点,算法对预测出的值N:;与真实值NAHEBR
差值,对残差值再进行熵编码。式(4)为低频子带
预测公式,N:,;表示图像像素真实值,i,j表示当前
对LL子带预测后的像素值,以及变换后的其
它各子带系数,本文在熵编码阶段,先进行自适应
零游程编码,之后,再对零游程编码后的结果札用
*一0的指数哥伦布编码。自适应零游程编码时,只
有一个零游程,具体方法概括为,当对样本进行编
码时,如果连续出现2个或2个以上的零,则在后
面标记出当前零的个数,如果没有2个以上的零出
现,则不进行编码,举例说明:
10 45 0 0 0 1 0 0 32 0 0 0 0 0 0 0 0 0 0
编码后结果:…345014008104500
1 1000 3200 8;
指数哥伦布编码由两部分构成,分别为组编号
与组内符号。组编码采用一元码,组内符号为定长
码结构。式(5)为其码字结构,其中,a表示组符
Sor表示组内符号,表示定长编码,为组内符
号数。本文算法在&二0时,样本x的指数胡伦布
码 最 终 码 字 code, HX (6) HERB. HP, bin,
MRRx的务位二进制形式。n表示待编码字,
2乙1表示最终的哥伦布编码码字长度。
由于采用哥伦布码编码时只能对非负数进行
编码,所以在编码前预先对所有编码像素进行非负
子带,在其第一行上侧与第一列左侧分别增加一行
与一列数据,且这些数据值都为零。
表 1 图像各级子带量化阶步长选择
Tab. 1 Quantization steps for different subbands of image
. HH HL LH ILL
14 16A 8A 84 一 一
2级844A4A一一
3级4A2A2A一一
4级一一AAA
映射,映射规则如式(7)所示:
为检验上述算法的编码性能,分别采用本文算
法,JPEG2000标准以及SPIHT3种算法进行仿真一
测试比较,图3为3种算法的PSNR测试曲线。从
图 3 可以看出,相比于SPIHT算法,本文算法明显
.优于其编码性能;相对于JPEG2000标准,本文算
法由于重点关注硬件的低延时高速实现,在图像编
码质量上略低于JPEG2000标准,但本文算法较好
地平衡了算法复杂度与图像压缩质量之间的矛盾,
满足了系统对图像压缩质量的要求。
算法采用模块化实现结构,针对算法的各个环
节单独设计模块单元。首先,对采集到的图像数据
必须先进行具有一行图像数据量大小存傅能力的
缓存操作,以消除图像采集对编码单元的干扰,提
高压缩系统的可靠性与数据吞吐量。从编码算法
提升,再进行完整的列提升就可实现多级变换,则
整个算法的并行化操作将变得简单。针对这一需
求,文献[17J在仔细分析式(1)和式(2),以及变换
时数据空间的位置组合关系基础上,得出在进行二
维提升操作时,每个像泰的操作仅和其周围4个垂
直、水平相关的像素有关,提出并实现了一种在进
行任何一级提升变换时,仅需要缓存3行数据即可
进行提升的操作,提升结果相对于输人数据延时不
到30个时钟周期。图4为一级二维5/3提升变换
示意图。
像用于提升小波变换的各个子带数据并行化输出
后,根据子带数据类型的不同,采用不同的量化阶。
由于每个子带量化阶为2的整数次幂,故对输出数
据仅采用移位操作即可。由算法原理可知,熵编码
器首先采用的是零游程编码,零游程编码器由零计
数器和零判决器构成,结构简单。零游程编码器输
出结果再采用k一0的指数哥伦布编码器编码,指
数哥伦布编码器按照式(6)实现,图6为指数哥伦
布硬件编码结构图。首先,对输人样本c进行非负
映射为,通过查找表找出n十1对应的二进制数
据最高位1(即有DKE2L~-1,加!后的样本暂存
在Regiserl中,累加控制器通过查找表得知现有
已编码码长,并通过control2查看Register2寄存
器中的码流长度,如果Register2中的比特长度小
于64,则通过或操作合并Register1和Register?
中的比特流;如果Register2中的比特长度超过了
64,则取出Registerl和Register2中的低64位,相
“或“之后,放人Register2的高64位,将低64位补
零,同时,使能并输出Register2中的高64位比特
流,Dataoutput为压缩后最终码流。
从上述算法压缩硬件并行实现结构中可以看
出,整个编码系统在采集数行数据后即开始压缩,
4“系统测试分析
根据上述图像压缩算法原理及其硬件实现架
构,完成了整个编码系统的设计与实现。编码系统
包括图像采集单元,多级小波变换引擎以及熵编码
器引擎等。系统硬件编码单元在XILINX-VIR-
TEX-5-XC5VSX50T-2中完成,在编码单元设设为
1路最高支持图像分辨率为2048pixelX2:848
pixelX12bit情况下,FPGA编码综合数据吞吐量
高达280Mpixel/ys,编码速度远高于目前市场上专
用图像压缩芯片的编码速度,硬件资源消耗量最高
为BlockRAM的资源占有量,其占整个芯片资源
的22%,SliceRegisters资源消耗量占全部资源的
20%,SliceLUTs占有量为14%。通过主要的资
源占有量可以得出,在该款型号的FPGA中至少
可 以 同 时 完 成 4 路 2 048 pixelX 2 048 pixel X 12
bit的高清视频编码。此外,本文硬件设计在充分
分析算法压缩数据流特性基础上,采用没有地址线
的全FIFO缓存数据流,并对最长路径进行切割,
最大限度地提升了FPGA的数据吞吐量,使得该
硬件编码器的图像压缩速度远高于目前市场上专
用图像压缩芯片的编码速度。
为进一步检测本文所设计的硬件编码系统的
编解码传输系统的时延大小,通过搭建相应的测试
平台完成了系统测试。其中,测试相机图像分辨率
为 1024 pixel X 768 pixel, 图 像 帧 频 为 25 frame/s,
数据链路带宽为8Mbps,解码形式为软解码,解码
PC 机 配 置 为 Interl(R) ,Xeon(R) ,CPU 主 频 为 2.
39GHz,内存8GB,DELL工作站机器。通过在编
码端加人突发脉冲,在解码端利用示波器检测脉冲
出现的时间差,进而计算出编解码传输时延。测试
结果表明,本文所设计的图像压缩传输系统延时远
低于100ms,满足无人飞行器测控系统对超低延
时高速图像压缩技术的需求。
该编码器结构之所以能够做到如此低的时延,
主要原因是编码器压缩后码速率与信道传输速率
较为匹配,压缩后码速率较为均匀,而专用图像压
缩芯片在进行编码时,压缩后的码速率相对于信道
传输速率是一种窝发方式,这使得信道在进行传输
数据时需要花费很长的时间传输专用图像压缩芯
片突发产生的大容量数据,在没有码流产生时,信
道则需要传输更多无效数据,这不仅产生了很大的
编解码图像延迟,而且浪费了信道带宽,造成严重
的资源浪费,本文所设计的低延时并行图像压缩系
“统则非常好地解决了这一问题。
5“结“论
本文针对无人飞行器测控系统对图像压缩技
术在超低延时与高速编码方面的特殊需求,研究并
设计了一种基于小波分析的全硬件并行图像压缩
系统。相对于目前国内外市场上推出的专用图像
压缩芯片而言,该压缩系统的最大特点是编解码传
输延时低,编码速度块。此外,由于本文的图像编
码系统采用全硬件并行实现,资源占有量较少,易
于将该压缩单元集成到其它硬件运算单元中,不需
要再使用其它专用图像压缩芯片或通用数字信号
处理器,满足了无人飞行器测控系统在高空密封
环境下对微系统、低功耗技术的需求。本文中的
图 像 压缩系统目前也存在一些不足,主要是图像
压缩比相对于一些视频压缩算法如H.264标准
还不够大。下一步工作的重点是在现有基础上,
加人帧间预测编码技术以进一步提高图像压
缩比。
